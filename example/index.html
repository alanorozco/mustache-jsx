<script>
  const section = (ref, cb) =>
    (Array.isArray(ref) ? (ref.length > 0 ? ref : []) : ref ? [ref] : []).map(
      cb
    );

  const inverted = (ref) => !ref || (Array.isArray(ref) && ref.length === 0);

  self._template = (view, h, Fragment, html) =>
    h(
      Fragment,
      null,
      h(
        "ul",
        null,
        section(view("items"), (_0_items, _i_0) =>
          h(
            Fragment,
            null,
            inverted(view("nested", _0_items)) &&
              h("li", null, view(null, _0_items)),
            section(view("nested", _0_items), (_1_nested, _i_1) =>
              h("li", null, view(null, _1_nested, _0_items))
            )
          )
        )
      ),
      inverted(view("falsy")) && "Inverted section: falsy value",
      html(view("unsafeHtml"))
    );
</script>
<script type="module">
  import { renderTemplate } from "./run.js";

  const DATA = {
    items: [
      "one",
      "two",
      "three",
      "<div>Should be escaped</div>",
      { nested: ["nested 1", "nested 2"] },
    ],
    unsafeHtml: "<b>unsafeHtml</b>",
  };

  renderTemplate(self._template, DATA, document.body);
</script>
